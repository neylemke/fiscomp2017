(function() {
  var MAX_FILE_SIZE, _secret_token, fs, misc, winston;

  fs = require('fs');

  winston = require('winston');

  misc = require('smc-util/misc');

  exports.secret_token_filename = process.env['SMC'] + "/secret_token";

  _secret_token = void 0;

  exports.secret_token = function() {
    return _secret_token != null ? _secret_token : _secret_token = fs.readFileSync(exports.secret_token_filename);
  };

  MAX_FILE_SIZE = 10000000;

  exports.check_file_size = function(size) {
    var e;
    if ((size != null) && size > MAX_FILE_SIZE) {
      e = "Attempt to open large file of size " + (Math.round(size / 1000000)) + "MB; the maximum allowed size is " + (Math.round(MAX_FILE_SIZE / 1000000)) + "MB. Use vim, emacs, or pico from a terminal instead.";
      winston.debug(e);
      return e;
    }
  };

  exports.json = function(out) {
    return misc.trunc(misc.to_json(out), 500);
  };

}).call(this);
